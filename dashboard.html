<script>
    const SUPABASE_URL = 'https://fppemnabevbcephyepwx.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZwcGVtbmFiZXZiY2VwaHllcHd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMTE1NzEsImV4cCI6MjA4NzY4NzU3MX0.0C51CdBQv7KkpJoIAHYe6NWveBJsyXyPpHVFvd6eP48';

    async function fetchRecords() {
        const list = document.getElementById('attendanceList');
        list.innerHTML = "<p style='text-align:center;'>Menarik data...</p>";

        try {
            // BARIS 98: Pastikan guna simbol ` (backtick) bukannya ' (single quote)
            const res = await fetch(`${SUPABASE_URL}/rest/v1/attendance?select=*&order=created_at.desc`, {
                headers: { 
                    'apikey': SUPABASE_KEY, 
                    'Authorization': `Bearer ${SUPABASE_KEY}` 
                }
            });
            
            const data = await res.json();
            
            list.innerHTML = "";
            if (!data || data.length === 0) {
                list.innerHTML = "<div class='record-card'>Tiada rekod aktif ditemui.</div>";
                return;
            }

            data.forEach(item => {
                const sebabText = item.sebab ? item.sebab.toLowerCase() : '';
                const statusClass = sebabText.includes('onsite') ? 'onsite' : 
                                    sebabText.includes('cuti') ? 'cuti' : 
                                    sebabText.includes('fat') ? 'fat' : 'mesyuarat';

                list.innerHTML += `
                    <div class="record-card">
                        <div class="info">
                            <h4>${item.nama}</h4>
                            <p>${item.jawatan} â€¢ <strong>${item.tarikh_mula}</strong> hingga <strong>${item.tarikh_akhir}</strong></p>
                        </div>
                        <div class="badge ${statusClass}">${item.sebab}</div>
                    </div>
                `;
            });
        } catch (e) {
            console.error("Ralat fail:", e);
            list.innerHTML = "<p style='color:red; text-align:center;'>Gagal memuatkan data. Sila semak konsol (F12).</p>";
        }
    }

    // Jalankan fungsi sebaik sahaja halaman siap dimuatkan
    window.onload = fetchRecords;
</script>
